# 歸檔與備份

## 介紹
SRE（網站可靠性工程師）確保服務持續運作（至少 99.99% 的時間），但在每個執行這些服務的伺服器上產生的資料量龐大。這些資料可能是日誌、資料庫中的使用者資料，或其他類型的元資料。因此，我們需要及時壓縮、歸檔、輪替及備份資料，以保障資料安全並確保空間不會耗盡。

## 歸檔

我們通常會將不再需要但主要為了合規目的而保留的資料進行歸檔。這幫助我們將資料儲存為壓縮格式，節省大量空間。以下章節將介紹歸檔工具和指令。

## gzip

gzip 是一個用於[<u>壓縮</u>](https://en.wikipedia.org/wiki/Data_compression)一個或多個檔案的程式，它會以壓縮版本取代原始檔案。

![](images/image14.png)

我們可以看到，*messages* 日誌檔案被壓縮到原始大小的約五分之一，並以 messages.gz 取代。我們可以使用 [*<u>gunzip</u>*](https://linux.die.net/man/1/gunzip) 指令將此檔案解壓縮。

## tar

*tar* 程式是一個將檔案和資料夾打包成單一檔案（通常稱為 tarball）的工具。這個工具通常用於在傳送資料到長期備份伺服器之前準備檔案的歸檔。*tar* 不會取代已存在的檔案和資料夾，而會建立一個新的副檔名為 *.tar* 的檔案。它提供許多選項供歸檔時使用。

| 選項  | 說明 |
| --- | --- |
| -c  | 建立歸檔檔案 |
| -x  | 解開歸檔檔案 |
| -f  | 指定歸檔檔案名稱 |
| -t  | 顯示或列出歸檔之中的檔案 |
| -u  | 更新並加入已有的歸檔檔案 |
| -v  | 顯示詳細資訊 |
| -A  | 合併多個歸檔檔案 |
| -z  | 以 gzip 壓縮 tar 檔案 |
| -j  | 以 bzip2 壓縮 tar 檔案 |
| -W  | 驗證歸檔檔案 |
| -r  | 更新或新增檔案/資料夾至已存在的 .tar 檔案 |

### 建立包含多個檔案與資料夾的歸檔

使用 `c` 選項建立歸檔，`f` 用於指定檔案名稱。

![](images/image24.png)

### 列出歸檔內的檔案

可以使用 `t` 選項列出歸檔內包含的內容。

![](images/image7.png)

### 從歸檔中解壓檔案

使用 `x` 選項解壓歸檔。

![](images/image26.png)

## 備份

備份是複製/複製現有資料的過程，在資料遺失時可以用來還原資料集。當資料在日常工作中不常用，但在未來可能作為真實資料來源及合規依據時，備份就顯得非常重要。不同類型的備份包括：

### 增量備份

增量備份是自上次備份之後的新資料備份，可以減少資料冗餘，並提高儲存效率。

### 差異備份

當資料持續修改或更新時，差異備份會備份自上次備份後發生的變更。

### 網路備份

網路備份指的是以客戶端-伺服器架構，將資料從來源透過網路傳送至備份目的地。備份目的地可以是集中式的，也可以是分散式的，後者適合災難復原的情境。

`rsync` 是 Linux 中一個可將檔案從一台伺服器同步至另一台目的地伺服器的指令。

![](images/image11.png)

*rsync* 的語法格式為 `rsync \[options\] <source> <destination>`。在「*destination*」中，可於冒號 `:` 後指定檔案路徑；若未指定，預設路徑是用於備份的使用者主目錄，例如此案例中的 `/home/azureuser`。您可以使用 `man rsync` 指令查閱更多 rsync 選項。

### 雲端備份

有許多第三方提供將資料備份至雲端的服務。這些雲端備份比儲存在本地機器或未配置 RAID 的普通伺服器備份更為可靠，因為這些服務提供資料冗餘、資料復原及資料安全管理。目前兩個最廣泛使用的雲端備份方案是 Azure 備份（由微軟提供）和 Amazon Glacier 備份（由 AWS 提供）。
